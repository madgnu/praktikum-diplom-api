# praktikum-diplom-api

Диплом я.практикума по вебу. Бэкенд.
Простенький сервер для авторизации пользователей и сохраанения статей.
Написано на ноде с монгой.

## Как достучаться

* [http://praktikum-diploma-api.madg.nu] http
* [https://praktikum-diploma-api.madg.nu] https

## Как развернуть

1. Склонировать репозиторий `git clone https://github.com/madgnu/praktikum-diploma-api.git`
2. Доставить зависимости `npm install`
3. Добавить конфигурационный файл `.env` (см. раздел конфигурационные параметры)
4. Запустить `npm run start`
*Для запуске в dev-середе* наберите `npm run dev`

## Конфигурационные параметры

Конфигурация осуществляется при помощи `.env` файла (в продакшн-среде - исключительно. Во избежании разных неприятностей).
В dev-среде сервер запустится с параметрами по-умолчанию при отсутствии конфига.

* `PORT` - порт, на котором стартует сервер. Обязательный параметр для прода.
* `JWT_SECRET` - секрет для шифрования токенов аутентификации. Обязательный параметр для прода.
* `DB_URI` - URI базы mongo. Обязательный параметр для прода.
* `AUTH_STRATEGY` - способ авторизации. Поддерживается `cookie` и `bearer`. По-умолчанию - `bearer`.
* `LOGS_FORMAT` - формат логов. Поддерживаются `short`, `json` и `logstash`. По-умолчанию - `json`.
* `LOGS_TYPE` - стратегия логирования. Поддерживаются `tty` (stdout/stderr) и `file`. По-умолчанию - `file`.
* `LOGS_DIR` - при записи логов в файл данный параметр определяет путь для складирования логов. По-умолчанию - `logs`.
* `REQ_PER_MIN` - количество запросов в секунду. По-умолчанию - 100.

*Примечание:* значения по-умолчанию указаны для production environment.

## Разные штучки, облегчающие жизнь

* `npm run test:lint` - прогнать код через статический анализатор, который определяет что код в целом написан по некоторым гайдлайнам (eslint/aribnb)
* `npm run test:cq` - прогнать код через другой статический анализатор, который определяет качество кода. (ну или пытается по крайней мере, реализовано чере codequality с настройками по-умолчанию). **Требуется докер**.
* `npm run build:cq` - собрать красивую страничку по codequality, это легче, чем ломать глаза об json.
* `npm run build:image` - собрать докер-образ. **Требуется докер**
* `docker-compose build && docker-compose up` - если очень лениво. Упаковывает приложение и стартует его экземпляр с базой.
